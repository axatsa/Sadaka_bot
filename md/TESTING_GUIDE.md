# Руководство по тестированию функции Дуа

## Предварительная подготовка

1. Создайте бота через [@BotFather](https://t.me/BotFather)
2. Получите токен бота
3. Узнайте ваш Chat ID (можно через [@userinfobot](https://t.me/userinfobot))
4. Создайте файл `.env` на основе `.env.example`:

```env
BOT_TOKEN=ваш_токен_от_botfather
ADMIN_PASSWORD=72780407
ADMIN_CHAT_ID=ваш_chat_id
```

## Установка и запуск

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск бота
python main.py
```

## Сценарии тестирования

### Тест 1: Базовая отправка дуа

**Предварительные условия:**
- База данных пустая или пользователь отправил < 2 дуа
- Всего отправлено < 20 дуа на текущую Жума

**Шаги:**
1. Пользователь нажимает кнопку "Оставить дуа" (callback: `send_dua`)
2. Бот показывает вопрос о выборе имени
3. Пользователь выбирает "Моё имя" или "Анонимно"
4. Бот запрашивает текст дуа
5. Пользователь вводит текст
6. Бот сохраняет дуа и отправляет администратору

**Ожидаемый результат:**
- Дуа сохранена в БД
- Администратор получил сообщение с дуа
- Пользователь видит подтверждение
- Счетчик дуа увеличился

---

### Тест 2: Превышение лимита пользователя

**Предварительные условия:**
- Пользователь уже отправил 2 дуа на текущую Жума

**Шаги:**
1. Пользователь нажимает "Оставить дуа"
2. Бот проверяет лимит

**Ожидаемый результат:**
- Показано сообщение: "Вы уже отправили 2 дуа на эту Жума..."
- Кнопка "Назад" для возврата в меню
- Дуа не отправлена

---

### Тест 3: Превышение общего лимита

**Предварительные условия:**
- Всего отправлено >= 20 дуа на текущую Жума

**Шаги:**
1. Пользователь нажимает "Оставить дуа"
2. Бот проверяет общий лимит

**Ожидаемый результат:**
- Показано сообщение: "Лимит дуа на эту Жума исчерпан..."
- Кнопка "Назад"
- Дуа не отправлена

---

### Тест 4: Предупреждение о приближении к лимиту

**Предварительные условия:**
- Всего отправлено >= 15 дуа (осталось < 5 мест)
- Пользователь отправил < 2 дуа

**Шаги:**
1. Пользователь нажимает "Оставить дуа"
2. Бот показывает предупреждение

**Ожидаемый результат:**
- Показано сообщение: "Предупреждение: На эту Жума уже 15/20 дуа..."
- Кнопки: "Отправить сейчас" и "Оставить позже"
- При выборе "Отправить сейчас" - процесс продолжается
- При выборе "Оставить позже" - возврат в меню

---

### Тест 5: Анонимная дуа

**Шаги:**
1. Начать процесс отправки дуа
2. Выбрать "Отправить анонимно"
3. Ввести текст дуа

**Ожидаемый результат:**
- В БД поле `sender_name` = "Аноним"
- Поле `is_anonymous` = 1
- Администратор видит "От: Аноним"

---

### Тест 6: Дуа с реальным именем

**Шаги:**
1. Начать процесс отправки дуа
2. Выбрать "Моё имя"
3. Ввести текст дуа

**Ожидаемый результат:**
- В БД поле `sender_name` = имя из профиля пользователя
- Поле `is_anonymous` = 0
- Администратор видит реальное имя

---

### Тест 7: Многоязычность

**Шаги для каждого языка:**
1. Установить язык пользователя (uz_latin, uz_cyrillic, ru)
2. Начать процесс отправки дуа
3. Проверить все сообщения

**Ожидаемый результат:**
- Все тексты отображаются на выбранном языке
- Кнопки на правильном языке

---

## Проверка базы данных

```bash
# Открыть SQLite базу
sqlite3 sadaka_bot.db

# Проверить дуа
SELECT * FROM duas;

# Проверить количество дуа пользователя
SELECT COUNT(*) FROM duas WHERE user_id = YOUR_USER_ID AND juma_week = '2025-51';

# Проверить общее количество дуа
SELECT COUNT(*) FROM duas WHERE juma_week = '2025-51';
```

## Известные ограничения текущей реализации

1. **Требуется полная реализация бота** для полноценной работы:
   - Регистрация пользователей
   - Выбор языка
   - Обработчик /start
   - Главное меню

2. **Временное решение для тестирования:**
   - Можно создать временный обработчик /start
   - Можно вручную добавить пользователя в БД

## Быстрый тест-сценарий (SQL)

Для быстрого тестирования можно вручную добавить пользователя:

```sql
INSERT INTO users (user_id, username, first_name, language, state, display_name)
VALUES (YOUR_TELEGRAM_ID, 'testuser', 'Test User', 'ru', 'IN_MARATHON', 'Тест Юзер');
```

После этого можно тестировать функцию дуа через inline-кнопки.
