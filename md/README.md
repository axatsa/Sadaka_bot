# Sadaka Bot - Функционал Дуа

Реализация функционала отправки дуа для Telegram-бота марафона садака.

## Установка

1. Создайте виртуальное окружение:
```bash
python -m venv .venv
```

2. Активируйте виртуальное окружение:
```bash
# Windows
.venv\Scripts\activate

# Linux/Mac
source .venv/bin/activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Настройте конфигурацию:
```bash
cp .env.example .env
```

Отредактируйте файл `.env` и добавьте:
- `BOT_TOKEN` - токен вашего Telegram-бота от @BotFather
- `ADMIN_CHAT_ID` - ID чата администратора для получения дуа

## Запуск

```bash
python main.py
```

## Реализованный функционал дуа

### Основные возможности:

1. **Отправка дуа пользователями**
   - Выбор имени (реальное имя или анонимно)
   - Ввод текста дуа
   - Отправка дуа администратору

2. **Система лимитов**
   - Максимум 2 дуа от одного пользователя на одну Жума
   - Максимум 20 дуа всего на одну Жума
   - Предупреждение при приближении к лимиту (остается менее 5 мест)

3. **Многоязычность**
   - Поддержка трех языков: O'zbekcha (латиница), O'zbekcha (кириллица), Русский
   - Все тексты локализованы

4. **FSM состояния**
   - `WAITING_DUA_NAME_CHOICE` - выбор имени для отправки
   - `WAITING_DUA` - ожидание текста дуа

### Структура базы данных:

**Таблица `duas`:**
- `id` - уникальный идентификатор
- `user_id` - ID пользователя Telegram
- `text` - текст дуа
- `sender_name` - имя отправителя
- `is_anonymous` - флаг анонимности
- `juma_week` - неделя Жумы (формат: YYYY-WW)
- `created_at` - дата создания

### Логика работы:

1. Пользователь нажимает кнопку "Оставить дуа"
2. Бот проверяет лимиты:
   - Если пользователь уже отправил 2 дуа - показывает сообщение об ограничении
   - Если всего отправлено 20 дуа - показывает сообщение об исчерпании лимита
   - Если осталось менее 5 мест - показывает предупреждение с выбором
3. Бот просит выбрать имя (реальное/анонимное)
4. Пользователь вводит текст дуа
5. Дуа сохраняется в БД и отправляется администратору
6. Пользователю показывается подтверждение

## Структура проекта

```
sadaka_bot/
├── bot/
│   ├── __init__.py
│   ├── config.py              # Конфигурация бота
│   ├── states.py              # FSM состояния
│   ├── middlewares.py         # Middleware для БД
│   ├── database/
│   │   ├── __init__.py
│   │   └── models.py          # Модели БД и работа с дуа
│   ├── handlers/
│   │   ├── __init__.py
│   │   └── dua_handlers.py    # Обработчики для дуа
│   └── locales/
│       └── texts.py           # Многоязычные тексты
├── main.py                    # Точка входа
├── requirements.txt           # Зависимости
├── .env.example              # Пример конфигурации
└── README.md                 # Документация
```

## Следующие шаги

Для полноценной работы бота необходимо реализовать:
- Регистрацию пользователей
- Выбор языка
- Основное меню
- Обработчик /start
- Другие функции марафона
